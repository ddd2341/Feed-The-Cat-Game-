<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        background-color: black;
      }
      .container {
        display: flex;
        justify-content: center;
      }
      .catImage {
        border: 30px solid blue;
        border-radius: 10px;
        width: 600px;
        height: 360px;
      }
      #xpBar {
        background-color: white;
        width: 80px;
        height: 400px;
        position: absolute;
        left: 85%;
        text-align: center;
        font-size: 30px;
      }
      #progBar {
        background-color: blue;
        bottom: 0%;
        width: 80px;
        height: 0%;
        position: absolute;
        text-align: center;
      }

      .button:active {
        background-color: black;
      }

      #Info {
        background-color: white;
        width: 200px;
        height: 400px;
        position: absolute;
        right: 85%;
        text-align: center;
        font-size: 30px;
      }

      #buttonDiv {
        position: absolute;
        display: flex;
        top: 60%;
        width: 100%;
        height: 300px;
        background-color: aqua;
        justify-content: center;
        align-items: center;
      }
      .button {
        width: 600px;
        height: 200px;
        border: 7px solid black;
        border-radius: 5px;
        margin: auto;
      }
      #feed {
        background-image: "food1.png";
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="imageDiv">
        <img class="catImage" id="cat" src="Level1.png" />
      </div>
      <div id="xpBar">
        EXP
        <div id="progBar"></div>
      </div>
      <div id="Info">Info</div>
      <div id="buttonDiv">
        <button class="button" id="feed">밥 주기</button>
        <button class="button" id="water">물 먹이기</button>
      </div>
    </div>
    <script>
      let EXP = 0,
        setEXP = 1000,
        Level = 1,
        feed,
        water,
        crit = 0,
        plusEXP,
        failPercent = 5;

      let feedBtn = document.getElementById("feed");
      let waterBtn = document.getElementById("water");

      function EXPset() {
        crit = 0;
        plusEXP =
          Math.floor(Math.random() * (Level * (Level * 2 + 17) - 10 * Level)) +
          10 * Level;
        //레벨 상승
        if (EXP >= setEXP && Math.floor(Math.random() * 100) > failPercent) {
          Level++;
          EXP -= setEXP;
          setEXP = Math.floor(setEXP * (1.5 + Level / 5));
          document.getElementById("cat").src = `Level${Level}.png`;
          failPercent++;
        }

        if (EXP >= setEXP && Math.floor(Math.random() * 100) <= failPercent) {
          EXP -= setEXP;
          failPercent++;
        }

        if (Math.floor(Math.random() * 100) >= 95) {
          crit = 1;
        }

        //밥줄때 경험치 계산(크리티컬)
        if (crit == 0) {
          EXP += plusEXP;
        } else {
          EXP += plusEXP * 10;
        }

        document.getElementById("cat").style.borderColor = "white";
        document.getElementById("cat").style.borderColor = "blue";
        document.getElementById("progBar").style.transitionTimingFunction =
          "ease-out";
        document.getElementById("progBar").style.transitionDuration = "0.2s";
        document.getElementById("progBar").style.height = `${
          (EXP / setEXP) * 100
        }%`;
        console.log(`${EXP}  ${setEXP}`);
      }

      feedBtn.addEventListener("click", EXPset());

      feedBtn.addEventListener("keydown", EXPset());
    </script>
  </body>
</html>
